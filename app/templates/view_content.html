{% extends "base.html" %} {% block title %}{{ item.title or
item.original_filename }}{% endblock %} {% block extra_css %}
<style>
  .preview-container {
    background: linear-gradient(135deg, #1f2937, #374151);
    border-radius: 12px;
    padding: 2rem;
    min-height: 400px;
    display: flex;
    align-items: center;
    justify-content: center;
  }

  .metadata-badge {
    background-color: rgba(99, 102, 241, 0.1);
    border: 1px solid rgba(99, 102, 241, 0.3);
    color: #6366f1;
    padding: 0.5rem 1rem;
    border-radius: 8px;
    display: inline-flex;
    align-items: center;
    gap: 0.5rem;
  }
</style>
{% endblock %} {% block content %}
<div class="fade-in">
  <!-- Navigation Breadcrumb -->
  <nav aria-label="breadcrumb" class="mb-4">
    <ol class="breadcrumb">
      <li class="breadcrumb-item">
        <a href="{{ url_for('main.index') }}">Home</a>
      </li>
      <li class="breadcrumb-item">
        <a href="{{ url_for('main.browse', tab=file_type+'s') }}"
          >{{ file_type|title }}s</a
        >
      </li>
      <li class="breadcrumb-item active">
        {{ item.title or item.original_filename }}
      </li>
    </ol>
  </nav>

  <div class="row">
    <!-- Main Content -->
    <div class="col-lg-8">
      <!-- File Header -->
      <div class="card mb-4">
        <div class="card-body">
          <div class="d-flex justify-content-between align-items-start">
            <div class="d-flex align-items-start">
              <div class="me-3">
                <div
                  class="file-icon {{ item.file_type.split('/')[0] }}"
                  style="width: 64px; height: 64px"
                >
                  {% if file_type == 'image' %}
                  <i class="bi bi-image text-white fs-3"></i>
                  {% elif file_type == 'video' %}
                  <i class="bi bi-camera-video text-white fs-3"></i>
                  {% else %}
                  <i class="bi bi-file-earmark-text text-white fs-3"></i>
                  {% endif %}
                </div>
              </div>
              <div>
                <h1 class="h2 mb-2" style="color: #4361ee">
                  {{ item.title or item.original_filename }}
                </h1>
                {% if item.description %}
                <p class="text-muted mb-0">{{ item.description }}</p>
                {% endif %}
              </div>
            </div>
            <div class="dropdown">
              <button
                class="btn btn-outline-secondary dropdown-toggle"
                type="button"
                data-bs-toggle="dropdown"
              >
                <i class="bi bi-three-dots-vertical"></i>
              </button>
              <ul class="dropdown-menu dropdown-menu-end">
                <li>
                  <a
                    class="dropdown-item"
                    href="{{ item.file_url }}"
                    target="_blank"
                  >
                    <i class="bi bi-download me-2"></i>Download
                  </a>
                </li>
                <li><hr class="dropdown-divider" /></li>
                <li>
                  <button
                    class="dropdown-item text-danger"
                    data-bs-toggle="modal"
                    data-bs-target="#deleteModal"
                  >
                    <i class="bi bi-trash me-2"></i>Delete
                  </button>
                </li>
              </ul>
            </div>
          </div>
        </div>
      </div>

      <!-- File Preview -->
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0"><i class="bi bi-eye me-2"></i>Preview</h4>
        </div>
        <div class="card-body">
          <div class="preview-container">
            {% if file_type == 'image' %}
            <img
              src="{{ item.file_url }}"
              class="img-fluid rounded shadow"
              alt="{{ item.title or item.original_filename }}"
              style="max-height: 400px"
            />
            {% elif file_type == 'video' %}
            <video
              controls
              class="w-100 rounded shadow"
              style="max-height: 400px"
            >
              <source src="{{ item.file_url }}" type="{{ item.file_type }}" />
              Your browser does not support the video tag.
            </video>
            {% else %}
            <div class="text-center">
              <div class="mb-4">
                <i class="bi bi-file-earmark-text display-1 text-muted"></i>
              </div>
              <h4 class="text-muted">Preview not available</h4>
              <p class="text-muted">
                This file type cannot be previewed in the browser.
              </p>
              <a
                href="{{ item.file_url }}"
                target="_blank"
                class="btn btn-primary"
              >
                <i class="bi bi-download me-2"></i>Download to View
              </a>
            </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>

    <!-- Sidebar -->
    <div class="col-lg-4">
      <!-- File Information -->
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">
            <i class="bi bi-info-circle me-2"></i>File Information
          </h4>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <h6 class="fw-semibold mb-3">Metadata</h6>
            <div class="row g-2 mb-3">
              <div class="col-6">
                <div class="metadata-badge">
                  <i class="bi bi-file-earmark"></i>
                  <span>{{ item.formatted_size }}</span>
                </div>
              </div>
              <div class="col-6">
                <div class="metadata-badge">
                  <i class="bi bi-calendar"></i>
                  <span>{{ item.created_at[:10] }}</span>
                </div>
              </div>
            </div>

            <div class="table-responsive">
              <table class="table table-sm">
                <tbody>
                  <tr>
                    <th scope="row" class="text-muted">Filename:</th>
                    <td>{{ item.original_filename }}</td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-muted">Type:</th>
                    <td>
                      <span class="badge bg-dark">{{ item.file_type }}</span>
                    </td>
                  </tr>
                  <tr>
                    <th scope="row" class="text-muted">Uploaded:</th>
                    <td>{{ item.created_at }}</td>
                  </tr>
                  {% if file_type == 'image' and item.dimensions %}
                  <tr>
                    <th scope="row" class="text-muted">Dimensions:</th>
                    <td>
                      {{ item.dimensions.width }} Ã— {{ item.dimensions.height }}
                      px
                    </td>
                  </tr>
                  {% endif %} {% if file_type == 'video' and item.duration %}
                  <tr>
                    <th scope="row" class="text-muted">Duration:</th>
                    <td>{{ item.duration }} seconds</td>
                  </tr>
                  {% endif %}
                </tbody>
              </table>
            </div>
          </div>

          <!-- Quick Actions -->
          <div class="mb-4">
            <h6 class="fw-semibold mb-3">Quick Actions</h6>
            <div class="d-grid gap-2">
              <a
                href="{{ item.file_url }}"
                target="_blank"
                class="btn btn-success"
              >
                <i class="bi bi-download me-2"></i>Download File
              </a>
              <a
                href="{{ url_for('main.browse', tab=file_type+'s') }}"
                class="btn btn-outline-primary"
              >
                <i class="bi bi-arrow-left me-2"></i>Back to {{ file_type|title
                }}s
              </a>
            </div>
          </div>

          <!-- Share Options -->
          <div>
            <h6 class="fw-semibold mb-3">Share</h6>
            <div class="d-flex gap-2">
              <button
                class="btn btn-outline-primary flex-fill"
                onclick="shareFile()"
              >
                <i class="bi bi-share me-2"></i>Share
              </button>
              <button class="btn btn-outline-secondary" onclick="copyUrl()">
                <i class="bi bi-clipboard"></i>
              </button>
            </div>
          </div>
        </div>
      </div>

      <!-- Related Files -->
      <div class="card">
        <div class="card-header">
          <h4 class="mb-0">
            <i class="bi bi-files me-2"></i>Recent {{ file_type|title }}s
          </h4>
        </div>
        <div class="card-body">
          {% if related_files %} {% for related in related_files[:3] %}
          <div class="d-flex align-items-center mb-3">
            <div class="me-3">
              <div class="file-icon {{ related.file_type.split('/')[0] }}">
                {% if related.file_type.startswith('image/') %}
                <i class="bi bi-image text-white"></i>
                {% elif related.file_type.startswith('video/') %}
                <i class="bi bi-camera-video text-white"></i>
                {% else %}
                <i class="bi bi-file-earmark-text text-white"></i>
                {% endif %}
              </div>
            </div>
            <div class="flex-grow-1">
              <h6 class="mb-0">
                {{ related.title or related.original_filename }}
              </h6>
              <small class="text-muted">{{ related.formatted_size }}</small>
            </div>
            <div>
              <a
                href="{{ url_for('main.view_item', file_type=file_type, item_id=related[file_type+'_id']) }}"
                class="btn btn-sm btn-outline-primary"
              >
                <i class="bi bi-eye"></i>
              </a>
            </div>
          </div>
          {% endfor %} {% else %}
          <p class="text-muted mb-0">No other {{ file_type }}s found</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>

<!-- Delete Modal -->
<div class="modal fade" id="deleteModal" tabindex="-1">
  <div class="modal-dialog">
    <div class="modal-content">
      <div class="modal-header">
        <h5 class="modal-title">Delete Confirmation</h5>
        <button
          type="button"
          class="btn-close"
          data-bs-dismiss="modal"
        ></button>
      </div>
      <div class="modal-body">
        <div class="text-center mb-4">
          <i class="bi bi-exclamation-triangle display-1 text-danger"></i>
        </div>
        <p class="text-center">Are you sure you want to delete this file?</p>
        <div class="alert alert-warning">
          <i class="bi bi-exclamation-triangle me-2"></i>
          <strong>Warning:</strong> This action cannot be undone. The file will
          be permanently removed from storage.
        </div>
      </div>
      <div class="modal-footer">
        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">
          Cancel
        </button>
        <form
          method="POST"
          action="{{ url_for('main.delete_item', file_type=file_type, item_id=item[file_type+'_id']) }}"
        >
          <button type="submit" class="btn btn-danger">
            Delete Permanently
          </button>
        </form>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  function shareFile() {
    if (navigator.share) {
      navigator.share({
        title: "{{ item.title or item.original_filename }}",
        text: "Check out this file from Memory Vault",
        url: window.location.href,
      });
    } else {
      copyUrl();
    }
  }

  function copyUrl() {
    navigator.clipboard.writeText(window.location.href);
    alert("URL copied to clipboard!");
  }

  document.addEventListener("DOMContentLoaded", function () {
    // Add any view-specific JavaScript here
    console.log(
      "View page loaded for:",
      "{{ item.title or item.original_filename }}"
    );
  });
</script>
{% endblock %}
