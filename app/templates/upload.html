{% extends "base.html" %} {% block title %}Upload Files{% endblock %} {% block
extra_css %}
<style>
  .upload-progress {
    height: 6px;
    border-radius: 3px;
    overflow: hidden;
    background-color: #374151;
  }

  .upload-progress-bar {
    height: 100%;
    background: linear-gradient(90deg, #6366f1, #8b5cf6);
    transition: width 0.3s ease;
  }
</style>
{% endblock %} {% block content %}
<div class="fade-in">
  <!-- Page Header -->
  <div class="mb-5">
    <h1 class="display-5 fw-bold mb-3">
      <i class="bi bi-cloud-upload me-2"></i>Upload Files
    </h1>
    <p class="text-muted">
      Upload documents, images, or videos to your secure vault
    </p>
  </div>

  <div class="row">
    <!-- Upload Form -->
    <div class="col-lg-8">
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">Upload Form</h4>
        </div>
        <div class="card-body">
          <form
            id="uploadForm"
            method="POST"
            action="{{ url_for('main.upload') }}"
            enctype="multipart/form-data"
          >
            <!-- File Type Selection -->
            <div class="mb-4">
              <label class="form-label fw-semibold mb-3"
                >Select File Type</label
              >
              <div class="row g-3">
                <div class="col-md-4">
                  <input type="radio" class="btn-check" name="file_type"
                  id="notes" value="notes" {% if current_type == 'notes'
                  %}checked{% endif %}>
                  <label class="btn btn-outline-primary w-100" for="notes">
                    <i class="bi bi-file-earmark-text display-6 mb-2"></i>
                    <div>Documents</div>
                    <small class="text-muted d-block">PDF, DOC, TXT</small>
                  </label>
                </div>
                <div class="col-md-4">
                  <input type="radio" class="btn-check" name="file_type"
                  id="images" value="images" {% if current_type == 'images'
                  %}checked{% endif %}>
                  <label class="btn btn-outline-primary w-100" for="images">
                    <i class="bi bi-image display-6 mb-2"></i>
                    <div>Images</div>
                    <small class="text-muted d-block">PNG, JPG, SVG</small>
                  </label>
                </div>
                <div class="col-md-4">
                  <input type="radio" class="btn-check" name="file_type"
                  id="videos" value="videos" {% if current_type == 'videos'
                  %}checked{% endif %}>
                  <label class="btn btn-outline-primary w-100" for="videos">
                    <i class="bi bi-camera-video display-6 mb-2"></i>
                    <div>Videos</div>
                    <small class="text-muted d-block">MP4, MKV, MOV</small>
                  </label>
                </div>
              </div>
            </div>

            <!-- File Metadata -->
            <div class="row g-3 mb-4">
              <div class="col-md-6">
                <label for="title" class="form-label fw-semibold"
                  >Title (Optional)</label
                >
                <input
                  type="text"
                  class="form-control"
                  id="title"
                  name="title"
                  placeholder="Enter a descriptive title"
                />
              </div>
              <div class="col-md-6">
                <label for="description" class="form-label fw-semibold"
                  >Description (Optional)</label
                >
                <textarea
                  class="form-control"
                  id="description"
                  name="description"
                  rows="1"
                  placeholder="Brief description"
                ></textarea>
              </div>
            </div>

            <!-- File Upload -->
            <div class="mb-4">
              <label class="form-label fw-semibold">Select File</label>
              <div class="upload-dropzone text-center py-5" id="dropzone">
                <i class="bi bi-cloud-arrow-up display-1 text-muted mb-3"></i>
                <p class="mb-2">Drag & drop your file here</p>
                <p class="text-muted mb-3">or click to browse</p>
                <input
                  class="form-control d-none"
                  type="file"
                  id="file"
                  name="file"
                  required
                />
                <button
                  type="button"
                  class="btn btn-primary"
                  onclick="document.getElementById('file').click()"
                >
                  <i class="bi bi-folder2-open me-2"></i>Browse Files
                </button>
                <div class="mt-3">
                  <small class="text-muted"
                    >Max file size: 100MB â€¢ Supported formats vary by
                    type</small
                  >
                </div>
              </div>
              <div id="fileInfo" class="mt-3 d-none">
                <div class="d-flex align-items-center">
                  <div class="me-3">
                    <i class="bi bi-file-earmark-text fs-4 text-primary"></i>
                  </div>
                  <div class="flex-grow-1">
                    <div
                      class="d-flex justify-content-between align-items-center"
                    >
                      <div>
                        <h6 class="mb-0" id="fileName">filename.ext</h6>
                        <small class="text-muted" id="fileSize">0 KB</small>
                      </div>
                      <button
                        type="button"
                        class="btn btn-sm btn-outline-danger"
                        onclick="clearFile()"
                      >
                        <i class="bi bi-x"></i>
                      </button>
                    </div>
                    <div class="upload-progress mt-2">
                      <div
                        class="upload-progress-bar"
                        id="uploadProgress"
                        style="width: 0%"
                      ></div>
                    </div>
                  </div>
                </div>
              </div>
            </div>

            <!-- Submit Button -->
            <div class="d-flex justify-content-between">
              <a
                href="{{ url_for('main.browse') }}"
                class="btn btn-outline-secondary"
              >
                <i class="bi bi-arrow-left me-2"></i>Back to Browse
              </a>
              <button type="submit" class="btn btn-primary px-4" id="submitBtn">
                <i class="bi bi-cloud-upload me-2"></i>Upload File
              </button>
            </div>
          </form>
        </div>
      </div>
    </div>

    <!-- Upload Guidelines -->
    <div class="col-lg-4">
      <div class="card mb-4">
        <div class="card-header">
          <h4 class="mb-0">
            <i class="bi bi-info-circle me-2"></i>Upload Guidelines
          </h4>
        </div>
        <div class="card-body">
          <div class="mb-4">
            <h6 class="fw-semibold mb-3">Supported Formats</h6>
            <div class="mb-3">
              <span class="badge bg-primary me-2 mb-2">PDF</span>
              <span class="badge bg-primary me-2 mb-2">DOC/DOCX</span>
              <span class="badge bg-primary me-2 mb-2">TXT</span>
              <span class="badge bg-primary me-2 mb-2">PPT/PPTX</span>
              <span class="badge bg-primary me-2 mb-2">XLS/XLSX</span>
            </div>
            <div class="mb-3">
              <span class="badge bg-success me-2 mb-2">PNG</span>
              <span class="badge bg-success me-2 mb-2">JPG/JPEG</span>
              <span class="badge bg-success me-2 mb-2">WEBP</span>
              <span class="badge bg-success me-2 mb-2">SVG</span>
              <span class="badge bg-success me-2 mb-2">GIF</span>
            </div>
            <div>
              <span class="badge bg-danger me-2 mb-2">MP4</span>
              <span class="badge bg-danger me-2 mb-2">MKV</span>
              <span class="badge bg-danger me-2 mb-2">AVI</span>
              <span class="badge bg-danger me-2 mb-2">MOV</span>
              <span class="badge bg-danger me-2 mb-2">WMV</span>
            </div>
          </div>

          <div class="mb-4">
            <h6 class="fw-semibold mb-3">Storage Information</h6>
            <ul class="list-unstyled text-muted">
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>Encrypted at
                rest
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>Redundant
                storage
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>24/7
                availability
              </li>
              <li class="mb-2">
                <i class="bi bi-check-circle text-success me-2"></i>Secure
                backup
              </li>
            </ul>
          </div>

          <div>
            <h6 class="fw-semibold mb-3">Quick Tips</h6>
            <div class="alert alert-info">
              <i class="bi bi-lightbulb me-2"></i>
              <small
                >Add descriptive titles and descriptions to make files easier to
                find later.</small
              >
            </div>
          </div>
        </div>
      </div>

      <!-- Recent Uploads -->
      <div class="card">
        <div class="card-header">
          <h4 class="mb-0"><i class="bi bi-clock me-2"></i>Recent Uploads</h4>
        </div>
        <div class="card-body">
          {% if recent_uploads %} {% for upload in recent_uploads[:3] %}
          <div class="d-flex align-items-center mb-3">
            <div class="me-3">
              <div class="file-icon {{ upload.file_type.split('/')[0] }}">
                {% if upload.file_type.startswith('image/') %}
                <i class="bi bi-image text-white"></i>
                {% elif upload.file_type.startswith('video/') %}
                <i class="bi bi-camera-video text-white"></i>
                {% else %}
                <i class="bi bi-file-earmark-text text-white"></i>
                {% endif %}
              </div>
            </div>
            <div class="flex-grow-1">
              <h6 class="mb-0">
                {{ upload.title or upload.original_filename }}
              </h6>
              <small class="text-muted">{{ upload.created_at[:10] }}</small>
            </div>
          </div>
          {% endfor %} {% else %}
          <p class="text-muted mb-0">No recent uploads</p>
          {% endif %}
        </div>
      </div>
    </div>
  </div>
</div>
{% endblock %} {% block scripts %}
<script>
  document.addEventListener("DOMContentLoaded", function () {
    const fileInput = document.getElementById("file");
    const dropzone = document.getElementById("dropzone");
    const fileInfo = document.getElementById("fileInfo");
    const fileName = document.getElementById("fileName");
    const fileSize = document.getElementById("fileSize");
    const uploadProgress = document.getElementById("uploadProgress");
    const submitBtn = document.getElementById("submitBtn");

    // Handle file selection
    fileInput.addEventListener("change", function (e) {
      if (this.files.length > 0) {
        updateFileInfo(this.files[0]);
      }
    });

    // Drag and drop functionality
    dropzone.addEventListener("dragover", function (e) {
      e.preventDefault();
      this.classList.add("dragover");
    });

    dropzone.addEventListener("dragleave", function (e) {
      e.preventDefault();
      this.classList.remove("dragover");
    });

    dropzone.addEventListener("drop", function (e) {
      e.preventDefault();
      this.classList.remove("dragover");

      if (e.dataTransfer.files.length > 0) {
        fileInput.files = e.dataTransfer.files;
        updateFileInfo(e.dataTransfer.files[0]);
      }
    });

    // Update file info display
    function updateFileInfo(file) {
      fileName.textContent = file.name;
      fileSize.textContent = formatFileSize(file.size);
      fileInfo.classList.remove("d-none");

      // Simulate upload progress (for demo)
      let progress = 0;
      const interval = setInterval(() => {
        progress += 5;
        uploadProgress.style.width = progress + "%";

        if (progress >= 100) {
          clearInterval(interval);
          submitBtn.disabled = false;
        }
      }, 100);
    }

    // Clear file selection
    window.clearFile = function () {
      fileInput.value = "";
      fileInfo.classList.add("d-none");
      uploadProgress.style.width = "0%";
    };

    // Format file size
    function formatFileSize(bytes) {
      if (bytes === 0) return "0 Bytes";
      const k = 1024;
      const sizes = ["Bytes", "KB", "MB", "GB"];
      const i = Math.floor(Math.log(bytes) / Math.log(k));
      return parseFloat((bytes / Math.pow(k, i)).toFixed(2)) + " " + sizes[i];
    }

    // Form validation
    document
      .getElementById("uploadForm")
      .addEventListener("submit", function (e) {
        if (!fileInput.files.length) {
          e.preventDefault();
          alert("Please select a file to upload");
          return false;
        }

        // Check file size (100MB limit)
        const maxSize = 100 * 1024 * 1024;
        if (fileInput.files[0].size > maxSize) {
          e.preventDefault();
          alert("File size exceeds 100MB limit");
          return false;
        }

        // Show loading state
        submitBtn.innerHTML =
          '<span class="spinner-border spinner-border-sm me-2"></span>Uploading...';
        submitBtn.disabled = true;
      });
  });
</script>
{% endblock %}
